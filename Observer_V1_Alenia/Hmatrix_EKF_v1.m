%% EKF A matrix numeric %%
function H = Hmatrix_EKF_v1(map,params,x,y)

    % quaternion
    q0 = x(1);
    q1 = x(2);
    q2 = x(3);
    q3 = x(4);
    
    % omega
    wx = x(5);
    wy = x(6);
    wz = x(7);
    
    % magnetometers
    if map.nMagneto >= 1
        Bx1 = y(4);
        By1 = y(5);
        Bz1 = y(6);
    end
    if map.nMagneto >= 2
        Bx2 = y(7);
        By2 = y(8);
        Bz2 = y(9);
    end
    
    %%% params %%%
    Ixx = params.sat(1).I(1,1);
    Iyy = params.sat(1).I(2,2);
    Izz = params.sat(1).I(3,3);
    mie = params.mi;
    r = params.SatellitesCoordinates(1:3);
    rx = r(1);
    ry = r(2);
    rz = r(3);
    r_norm = norm(r);
    
    % magnetometers
    dt1 = map.RPYbetweenMagSensors(1);
    dt2 = map.RPYbetweenMagSensors(2);
    dt3 = map.RPYbetweenMagSensors(3);
    
    %%% matrix computation %%%
    H = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0, 1, 0, 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0, 0, 1, 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0, 0, 0, 1;
           Bz1*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By1*((4*q0^2*q1)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) + Bx1*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q0^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q1^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2), - By1*((4*q0*q1^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz1*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q1^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx1*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q1^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q1)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2),   Bz1*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By1*((4*q2^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx1*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q2^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q2*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2), Bx1*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q3^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q2^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz1*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q1*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By1*((4*q2*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2), 0, 0, 0;
           Bx1*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0^2*q1)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz1*((4*q0^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By1*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q0^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q1^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2),   Bx1*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0*q1^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz1*((4*q1^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) + By1*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q1^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q1)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2), - Bx1*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q2^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz1*((4*q1*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By1*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q2^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q2*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2), By1*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q3^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q2^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz1*((4*q0*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx1*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q2*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2), 0, 0, 0;
         - Bx1*((4*q0^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By1*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz1*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q0^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0*q1^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2),   By1*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q1^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx1*((4*q1^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz1*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q1^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0^2*q1)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2),   By1*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q1*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx1*((4*q0*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) + Bz1*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q2^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q2*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2), Bz1*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q3^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q2^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By1*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx1*((4*q1*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2), 0, 0, 0;
           Bz2*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By2*((4*q0^2*q1)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) + Bx2*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q0^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q1^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2), - By2*((4*q0*q1^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz2*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q1^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx2*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q1^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q1)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2),   Bz2*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By2*((4*q2^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx2*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q2^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q2*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2), Bx2*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q3^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q2^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz2*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q1*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By2*((4*q2*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2), 0, 0, 0;
           Bx2*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0^2*q1)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz2*((4*q0^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By2*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q0^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q1^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2),   Bx2*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0*q1^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz2*((4*q1^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) + By2*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q1^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q1)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2), - Bx2*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q2^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz2*((4*q1*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By2*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q2^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q2*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2), By2*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q3^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q2^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz2*((4*q0*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx2*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q2*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2), 0, 0, 0;
         - Bx2*((4*q0^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By2*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz2*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q0^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0*q1^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2),   By2*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q1^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q1*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx2*((4*q1^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q1*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bz2*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q1^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0^2*q1)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2),   By2*((2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q1*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx2*((4*q0*q2^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) + Bz2*((2*q2)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q2^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1^2*q2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q2*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2), Bz2*((2*q3)/(q0^2 + q1^2 + q2^2 + q3^2) - (2*q3^3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q0^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (2*q1^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q2^2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - By2*((2*q0)/(q0^2 + q1^2 + q2^2 + q3^2) - (4*q0*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 + (4*q1*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2) - Bx2*((4*q1*q3^2)/(q0^2 + q1^2 + q2^2 + q3^2)^2 - (2*q1)/(q0^2 + q1^2 + q2^2 + q3^2) + (4*q0*q2*q3)/(q0^2 + q1^2 + q2^2 + q3^2)^2), 0, 0, 0];
        
    H(7:9,:) = map.Rtheta*H(7:9,:);
end